!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function o(e,t){for(var n=[],o=[],a=arguments.length;a-- >2;)n.push(arguments[a]);for(;n.length;){var r=n.pop();if(r&&r.pop)for(a=r.length;a--;)n.push(r[a]);else null!=r&&!0!==r&&!1!==r&&o.push(r)}return"function"==typeof e?e(t||{},o):{nodeName:e,attributes:t||{},children:o,key:t&&t.key}}function a(e,t){var n=e.to,a=e.location||window.location;return e.href=n,e.onclick=function(t){0!==t.button||t.altKey||t.metaKey||t.ctrlKey||t.shiftKey||"_blank"===e.target||t.currentTarget.origin!==a.origin||(t.preventDefault(),n!==a.pathname&&history.pushState(a.pathname,"",n))},o("a",e,t)}function r(e,t,n,o){return{isExact:e,path:t,url:n,params:o}}function i(e){for(var t=e.length;"/"===e[--t];);return e.slice(0,t+1)}function l(e){var t=e.location||window.location,n=function(e,t,n){if(e===t||!e)return r(e===t,e,t);var o=n&&n.exact,a=i(e).split("/"),l=i(t).split("/");if(!(a.length>l.length||o&&a.length<l.length)){var u=0,s={},d=a.length;for(t="";u<d;u++){if(":"===a[u][0])try{s[a[u].slice(1)]=l[u]=decodeURI(l[u])}catch(e){continue}else if(a[u]!==l[u])return;t+=l[u]+"/"}return r(!1,e,t.slice(0,-1),s)}}(e.path,t.pathname,{exact:!e.parent});return n&&e.render({match:n,location:t})}n.r(t);var u={state:{pathname:window.location.pathname,previous:window.location.pathname},actions:{go:function(e){history.pushState(null,"",e)},set:function(e){return e}},subscribe:function(e){function t(t){e.set({pathname:window.location.pathname,previous:t.detail?window.location.previous=t.detail:window.location.previous})}var n=["pushState","replaceState"].reduce(function(e,t){var n=history[t];return history[t]=function(e,t,o){n.call(this,e,t,o),dispatchEvent(new CustomEvent("pushstate",{detail:e}))},function(){history[t]=n,e&&e()}},null);return addEventListener("pushstate",t),addEventListener("popstate",t),function(){removeEventListener("pushstate",t),removeEventListener("popstate",t),n()}}};const s={height:735,width:1036,color:"rgba(0, 0, 0, 0.9)",edgeSize:100},d=()=>o("div",null,o("h2",null,"Read"),o(p,null)),c=({match:e})=>o("div",null,o("h2",null,"Edit"),o("p",null,"ドラッグ&ドロップで画像を入れられるよ"),o("p",null,"テキストはテキストボックスから入れてね"),o(p,{edit:!0})),p=({edit:e})=>(t,n)=>o("main",null,o("p",null,"ページ:",t.pageNum,"/",e?t.pageMax:t.pages.length),o("div",{style:{display:e?"block":"none"}},o("input",{type:"text",value:t.inputText,oninput:e=>{n.setText(e.target.value)}}),o("input",{type:"button",value:"テキスト挿入",onmouseup:e=>{n.addText(),n.savePage()}})),o("div",{style:{position:"relative"}},o("div",{Class:"edge top",style:{height:s.edgeSize,width:"100%",background:s.color,position:"absolute","z-index":1}}),o("div",{Class:"edge left",style:{top:s.edgeSize,height:s.height,width:s.edgeSize,background:s.color,position:"absolute","z-index":1}},o("p",{style:{"font-size":36,color:"#FFF",width:"auto",margin:30,cursor:"pointer",display:t.pageNum>1?"block":"none"},onclick:e=>{n.loadPage(t.pageNum-1)}},"◀")),o("div",{Class:"canvas",style:{position:"relative",width:s.width,height:s.height,left:s.edgeSize,top:s.edgeSize}},o("div",{style:{position:"absolute",left:s.width/2,height:s.height,"border-right":"#AAA solid 1px","z-index":1}}),t.images.map(t=>o("img",{src:t.src,draggable:0,onmousedown:o=>{e&&n.drag({id:t.id,offsetX:o.pageX-t.left,offsetY:o.pageY-t.top,target:"images"})},style:{width:t.width,left:t.left,top:t.top,cursor:e?"move":"init",position:"absolute",transform:"rotate("+t.deg+"deg)"}})),t.texts.map(t=>o("p",{style:{"user-select":"none","font-size":t.fontSize,left:t.left,top:t.top,width:t.width,cursor:e?"move":"init",position:"absolute",transform:"rotate("+t.deg+")"},onmousedown:o=>{e&&n.drag({id:t.id,offsetX:o.pageX-t.left,offsetY:o.pageY-t.top,target:"texts"})}},t.text))),o("div",{Class:"edge right",style:{top:s.edgeSize,height:s.height,position:"absolute",left:s.width+s.edgeSize,right:0,background:s.color,"z-index":1}},o("p",{style:{"font-size":36,color:"#FFF",margin:30,cursor:"pointer",display:t.pageNum<(e?t.pageMax:t.pages.length)?"block":"none"},onclick:e=>{n.loadPage(t.pageNum+1)}},"▶")),o("div",{Class:"edge bottom",style:{height:s.edgeSize,top:s.edgeSize,width:"100%",background:s.color,position:"relative","z-index":1}}))),g={location:u.actions,drop:()=>({dragData:{id:null}}),drag:e=>({dragData:e}),move:e=>t=>((e,t)=>{if(null===e.dragData.id)return null;const n=e[e.dragData.target].findIndex(t=>t.id===e.dragData.id);return Object.assign(e[e.dragData.target][n],{left:t.x-e.dragData.offsetX,top:t.y-e.dragData.offsetY})})(t,e),addImage:e=>t=>({images:t.images.concat({id:t.images.length,src:e,left:0,top:0,width:300,deg:0})}),setText:e=>t=>({inputText:e}),addText:()=>e=>({texts:e.texts.concat({id:e.texts.length,text:e.inputText,left:0,top:0,width:200,fontSize:18,deg:0})}),savePage:()=>e=>({pages:f(e)}),loadPage:e=>t=>((e,t)=>{const n=e.pages.findIndex(e=>e.pageNum===t);return n>=0?e.pages[n]:{pageNum:t,images:[],texts:[]}})(t,e)},f=e=>{const t=e.pages.findIndex(t=>t.pageNum===e.pageNum),n={pageNum:e.pageNum,images:e.images,texts:e.texts};var o=e.pages;return t<0?o.push(n):o[t]=n,console.log(o),o},h=function(e,t,n,o){var a,r=[].map,i=o&&o.children[0]||null,l=i&&function e(t){return{nodeName:t.nodeName.toLowerCase(),attributes:{},children:r.call(t.childNodes,function(t){return 3===t.nodeType?t.nodeValue:e(t)})}}(i),u=[],s=!0,d=h(e),c=function e(t,n,o){for(var a in o)"function"==typeof o[a]?function(e,a){o[e]=function(e){var r=a(e);return"function"==typeof r&&(r=r(m(t,d),o)),r&&r!==(n=m(t,d))&&!r.then&&f(d=v(t,h(n,r),d)),r}}(a,o[a]):e(t.concat(a),n[a]=h(n[a]),o[a]=h(o[a]));return o}([],d,h(t));return f(),c;function p(e){return"function"==typeof e?p(e(d,c)):e}function g(){a=!a;var e=p(n);for(o&&!a&&(i=function e(t,n,o,a,r){if(a===o);else if(null==o||o.nodeName!==a.nodeName){var i=function e(t,n){var o="string"==typeof t||"number"==typeof t?document.createTextNode(t):(n=n||"svg"===t.nodeName)?document.createElementNS("http://www.w3.org/2000/svg",t.nodeName):document.createElement(t.nodeName),a=t.attributes;if(a){a.oncreate&&u.push(function(){a.oncreate(o)});for(var r=0;r<t.children.length;r++)o.appendChild(e(t.children[r]=p(t.children[r]),n));for(var i in a)b(o,i,a[i],null,n)}return o}(a,r);t.insertBefore(i,n),null!=o&&w(t,n,o),n=i}else if(null==o.nodeName)n.nodeValue=a;else{!function(e,t,n,o){for(var a in h(t,n))n[a]!==("value"===a||"checked"===a?e[a]:t[a])&&b(e,a,n[a],t[a],o);var r=s?n.oncreate:n.onupdate;r&&u.push(function(){r(e,t)})}(n,o.attributes,a.attributes,r=r||"svg"===a.nodeName);for(var l={},d={},c=[],g=o.children,f=a.children,v=0;v<g.length;v++){c[v]=n.childNodes[v];var m=y(g[v]);null!=m&&(l[m]=[c[v],g[v]])}for(var v=0,x=0;x<f.length;){var m=y(g[v]),N=y(f[x]=p(f[x]));if(d[m])v++;else if(null==N||s)null==m&&(e(n,c[v],g[v],f[x],r),x++),v++;else{var z=l[N]||[];m===N?(e(n,z[0],z[1],f[x],r),v++):z[0]?e(n,n.insertBefore(z[0],c[v]),z[1],f[x],r):e(n,c[v],null,f[x],r),d[N]=f[x],x++}}for(;v<g.length;)null==y(g[v])&&w(n,c[v],g[v]),v++;for(var v in l)d[v]||w(n,l[v][0],l[v][1])}return n}(o,i,l,l=e)),s=!1;u.length;)u.pop()()}function f(){a||(a=!0,setTimeout(g))}function h(e,t){var n={};for(var o in e)n[o]=e[o];for(var o in t)n[o]=t[o];return n}function v(e,t,n){var o={};return e.length?(o[e[0]]=e.length>1?v(e.slice(1),t,n[e[0]]):t,h(n,o)):t}function m(e,t){for(var n=0;n<e.length;)t=t[e[n++]];return t}function y(e){return e?e.key:null}function x(e){return e.currentTarget.events[e.type](e)}function b(e,t,n,o,a){if("key"===t);else if("style"===t)for(var r in h(o,n)){var i=null==n||null==n[r]?"":n[r];"-"===r[0]?e[t].setProperty(r,i):e[t][r]=i}else"o"===t[0]&&"n"===t[1]?(e.events||(e.events={}),e.events[t=t.slice(2)]=n,n?o||e.addEventListener(t,x):e.removeEventListener(t,x)):t in e&&"list"!==t&&!a?e[t]=null==n?"":n:null!=n&&!1!==n&&e.setAttribute(t,n),null!=n&&!1!==n||e.removeAttribute(t)}function w(e,t,n){function o(){e.removeChild(function e(t,n){var o=n.attributes;if(o){for(var a=0;a<n.children.length;a++)e(t.childNodes[a],n.children[a]);o.ondestroy&&o.ondestroy(t)}return t}(t,n))}var a=n.attributes&&n.attributes.onremove;a?a(t,o):o()}}({location:u.state,pageNum:1,pageMax:4,texts:[],images:[],dragData:{id:null,offsetX:null,offsetY:null,target:null},inputText:null,pages:[]},g,e=>o("div",null,o(a,{to:"/"},o("h1",null,"IdeaZine")),o("ul",null,o("li",null,o(a,{to:"/"},"Home")),o("li",null,o(a,{to:"/read"},"Read")),o("li",null,o(a,{to:"/edit"},"Edit"))),o(l,{path:"/",render:c}),o(l,{path:"/read",render:d}),o(l,{path:"/edit",render:c})),document.body);addEventListener("mouseup",h.drop),addEventListener("mousemove",e=>h.move({x:e.pageX,y:e.pageY})),addEventListener("touchend",h.drop),addEventListener("touchmove",e=>h.move({x:e.pageX,y:e.pageY})),addEventListener("drop",e=>{e.preventDefault();var t=e.dataTransfer.files;console.log(e.pageX,e.pageY);for(var n=0;n<t.length;n++){var o=t[n];console.log(o);var a=new FileReader;a.onload=function(e){var t=e.target.result;h.addImage(t),h.savePage()},a.readAsDataURL(o)}}),addEventListener("dragover",e=>e.preventDefault());u.subscribe(h.location)}]);